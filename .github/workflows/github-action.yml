name: Node.js CI
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€

on: [push]

env:
  AZURE_WEBAPP_NAME: CI-CD
  AZURE_WEBAPP_PACKAGE_PATH: '/dist'

jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 18.x

    - name: Install dependencies
      run: npm install

    - name: Build
      run: npm run build

    - name: ESLint
      run: npm run lint

    # - name: ExÃ©cuter les tests
    #   run: npm test

    # - name: GÃ©nÃ©rer la couverture de code
    #   run: npm run coverage

    # - name: Publier le rapport
    #   uses: actions/upload-artifact@v2
    #   with:
    #     name: Rapport de couverture de code
    #     path: path/to/coverage/report
    
    - name: SonarCloud Scan
      uses: SonarSource/sonarcloud-github-action@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

    #ziper le fichier si trop long

    - name: Upload Artifact
      uses: actions/upload-artifact@v2
      with:
        name: app-artifact
        path: dist/
    
    - name: Deploy to Azure WebApp
      uses: azure/webapps-deploy@v2
      with: 
        app-name: ${{ env.AZURE_WEBAPP_NAME }}
        publish-profile: ${{ secrets.AZURE_DEPLOY_SECRET }}
        package: ${{ env.AZURE_WEBAPP_PACKAGE_PATH }}